<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | Shalom System Solutions</title>
  <link rel="stylesheet" href="admin.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="admin-wrapper">

  <!-- ==================== LOGIN SCREEN ==================== -->
  <div id="loginBox" class="login-screen">
    <div class="login-card">
      <div class="login-logo">
        <div class="logo-circle">S</div>
        <h1>Shalom Admin</h1>
        <p>System Solutions Management</p>
      </div>

      <div class="login-form">
        <div class="input-group">
          <label>üë§ Username</label>
          <input id="user" type="text" placeholder="Enter username" autocomplete="username">
        </div>

        <div class="input-group">
          <label>üîí Password</label>
          <input id="pass" type="password" placeholder="Enter password" autocomplete="current-password">
        </div>

        <button onclick="login()" class="btn-login">
          <span>Login to Dashboard</span>
          <span class="arrow">‚Üí</span>
        </button>

        <p id="err" class="error-message"></p>

        <div class="login-footer">
          
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== DASHBOARD ==================== -->
  <div id="dashboard" class="hidden">
    
    <!-- HEADER -->
    <header class="dashboard-header">
      <div class="header-left">
        <div class="logo-mini">S</div>
        <div>
          <h2>Admin Dashboard</h2>
          <p class="header-subtitle">Shalom System Solutions</p>
        </div>
      </div>
      <div class="header-right">
        <a href="index.html" class="btn-link">‚Üê Back to Website</a>
        <button onclick="logout()" class="btn-logout">Logout</button>
      </div>
    </header>

    <!-- STATS CARDS -->
    <div class="stats-grid">
      <div class="stat-card stat-products">
        <div class="stat-icon">üì¶</div>
        <div class="stat-info">
          <h3 id="productCount">0</h3>
          <p>Total Products</p>
        </div>
      </div>

      <div class="stat-card stat-inquiries">
        <div class="stat-icon">üìß</div>
        <div class="stat-info">
          <h3 id="inquiryCount">0</h3>
          <p>Customer Inquiries</p>
        </div>
      </div>

      <div class="stat-card stat-available">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-info">
          <h3 id="availableCount">0</h3>
          <p>Available Products</p>
        </div>
      </div>
    </div>

    <!-- TABS NAVIGATION -->
    <div class="tabs-nav">
      <button class="tab-btn active" onclick="switchTab('products')" id="tabProducts">
        <span class="tab-icon">üì¶</span>
        <span>Products Management</span>
      </button>
      <button class="tab-btn" onclick="switchTab('inquiries')" id="tabInquiries">
        <span class="tab-icon">üìß</span>
        <span>Customer Inquiries</span>
      </button>
    </div>

    <!-- ==================== PRODUCTS TAB ==================== -->
    <div id="productsTab" class="tab-content active">
      
      <!-- ADD PRODUCT CARD -->
      <div class="content-card">
        <div class="card-header">
          <h3>‚ûï Add New Product</h3>
          <button onclick="toggleAddForm()" class="btn-toggle" id="toggleBtn">
            <span id="toggleText">Hide Form</span>
          </button>
        </div>

        <div id="addProductForm" class="add-form">
          <div class="form-row">
            <div class="form-group">
              <label>Product Name *</label>
              <input id="pname" type="text" placeholder="e.g., Dell Laptop i5 8GB" required>
            </div>

            <div class="form-group">
              <label>Product Type *</label>
              <input id="ptype" type="text" placeholder="e.g., Laptop, Desktop, SSD" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Price (‚Çπ) *</label>
              <input id="pprice" type="number" placeholder="e.g., 45000" required>
            </div>

            <div class="form-group">
              <label>Availability *</label>
              <select id="pavailability">
                <option value="Available">‚úÖ Available</option>
                <option value="Out of Stock">‚ùå Out of Stock</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Description *</label>
            <textarea id="pdesc" rows="3" placeholder="Product details and specifications..." required></textarea>
          </div>

          <div class="form-group">
            <label>Product Image *</label>
            <div class="file-upload-area" id="fileUploadArea">
              <input type="file" id="pimage" accept="image/*" onchange="handleFileSelect(this)">
              <div class="file-upload-content">
                <div class="upload-icon">üì∑</div>
                <p class="upload-text">Click or drag image here</p>
                <p class="upload-hint">Supports: JPG, PNG, WEBP (Max 5MB)</p>
              </div>
              <div id="imagePreview" class="image-preview hidden">
                <img id="previewImg" src="" alt="Preview">
                <button onclick="clearImage()" class="btn-clear-image">‚úï</button>
              </div>
            </div>
          </div>

          <button onclick="addProduct()" class="btn-submit">
            <span>Add Product</span>
            <span class="btn-arrow">‚Üí</span>
          </button>
        </div>
      </div>

      <!-- PRODUCTS LIST CARD -->
      <div class="content-card">
        <div class="card-header">
          <h3>üì¶ All Products</h3>
          <div class="search-box">
            <input type="text" id="productSearch" placeholder="üîç Search products..." onkeyup="filterProducts()">
          </div>
        </div>

        <div id="adminProducts" class="products-grid"></div>
      </div>
    </div>

    <!-- ==================== INQUIRIES TAB ==================== -->
    <div id="inquiriesTab" class="tab-content">
      
      <div class="content-card">
        <div class="card-header">
          <h3>üìß Customer Inquiries</h3>
          <button onclick="clearInquiries()" class="btn-clear-all">
            <span>üóëÔ∏è</span>
            <span>Clear All</span>
          </button>
        </div>

        <div id="adminInquiries" class="inquiries-list"></div>
      </div>
    </div>

  </div>

</div>

<script>
/* ================= API (LOCAL DEV ONLY) ================= */
const API = "http://localhost:5000";

/* ================= DOM ================= */
const adminProducts = document.getElementById("adminProducts");
const adminInquiries = document.getElementById("adminInquiries");

/* ================= STATE ================= */
let products = [];
let inquiries = [];
let formVisible = true;

/* ================= LOGIN ================= */
function login() {
  if (user.value === "shalom" && pass.value === "shalom2026") {
    loginBox.classList.add("hidden");
    dashboard.classList.remove("hidden");
    err.style.display = "none";
    loadData();
  } else {
    err.textContent = "‚ùå Invalid credentials";
    err.style.display = "block";
  }
}

function logout() {
  location.reload();
}

/* ================= TABS ================= */
function switchTab(tab) {
  productsTab.classList.remove("active");
  inquiriesTab.classList.remove("active");
  tabProducts.classList.remove("active");
  tabInquiries.classList.remove("active");

  if (tab === "products") {
    productsTab.classList.add("active");
    tabProducts.classList.add("active");
  } else {
    inquiriesTab.classList.add("active");
    tabInquiries.classList.add("active");
  }
}

/* ================= LOAD DATA ================= */
async function loadData() {
  try {
    const productRes = await fetch(`${API}/api/products`);
    const inquiryRes = await fetch(`${API}/api/inquiries`);

    if (!productRes.ok || !inquiryRes.ok) {
      throw new Error("Backend not reachable");
    }

    products = await productRes.json();
    inquiries = await inquiryRes.json();

    updateStats();
    renderProducts(products);
    renderInquiries();
  } catch (err) {
    console.error(err);
    alert("‚ùå Backend not running. Start server.js");
  }
}

/* ================= STATS ================= */
function updateStats() {
  productCount.textContent = products.length;
  inquiryCount.textContent = inquiries.length;
  availableCount.textContent =
    products.filter(p => p.availability === "Available").length;
}

/* ================= PRODUCTS ================= */
function renderProducts(list) {
  if (!list.length) {
    adminProducts.innerHTML = "<p>No products added yet</p>";
    return;
  }

  adminProducts.innerHTML = list.map(p => `
    <div class="product-item">
      <img src="${p.image}" alt="">
      <h4>${p.name}</h4>
      <span>‚Çπ${p.price}</span>
      <button onclick="deleteProduct('${p._id}')">üóëÔ∏è</button>
    </div>
  `).join("");
}

function filterProducts() {
  const q = productSearch.value.toLowerCase();
  renderProducts(
    products.filter(p =>
      p.name.toLowerCase().includes(q) ||
      p.type.toLowerCase().includes(q)
    )
  );
}

/* ================= ADD PRODUCT ================= */
function toggleAddForm() {
  formVisible = !formVisible;
  addProductForm.style.display = formVisible ? "block" : "none";
  toggleText.textContent = formVisible ? "Hide Form" : "Show Form";
}

function handleFileSelect(input) {
  const file = input.files[0];
  if (!file) return;

  if (file.size > 1024 * 1024 * 1.5) {
    alert("‚ùå Image too large (max 1.5MB)");
    input.value = "";
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    previewImg.src = reader.result;
    imagePreview.classList.remove("hidden");
  };
  reader.readAsDataURL(file);
}

function clearImage() {
  pimage.value = "";
  imagePreview.classList.add("hidden");
}

async function addProduct() {
  if (!pimage.files[0]) {
    alert("‚ùå Select image");
    return;
  }

  const reader = new FileReader();
  reader.onload = async () => {
    const res = await fetch(`${API}/api/products`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: pname.value,
        type: ptype.value,
        price: Number(pprice.value),
        description: pdesc.value,
        availability: pavailability.value,
        image: reader.result
      })
    });

    if (!res.ok) {
      alert("‚ùå Failed to add product");
      return;
    }

    pname.value = ptype.value = pprice.value = pdesc.value = "";
    pimage.value = "";
    imagePreview.classList.add("hidden");

    await loadData();
    alert("‚úÖ Product added successfully");
  };

  reader.readAsDataURL(pimage.files[0]);
}

async function deleteProduct(id) {
  if (!confirm("Delete product?")) return;
  await fetch(`${API}/api/products/${id}`, { method: "DELETE" });
  loadData();
}

/* ================= INQUIRIES ================= */
function renderInquiries() {
  if (!inquiries.length) {
    adminInquiries.innerHTML = "<p>No inquiries yet</p>";
    return;
  }

  adminInquiries.innerHTML = inquiries.map(i => `
    <div class="inquiry-item">
      <h4>${i.name} ‚Äì ${i.phone}</h4>
      <p><b>Product:</b> ${i.product || "-"}</p>
      <p>${i.message || ""}</p>
    </div>
  `).join("");
}

async function clearInquiries() {
  if (!confirm("Clear all inquiries?")) return;
  await fetch(`${API}/api/inquiries`, { method: "DELETE" });
  loadData();
}
</script>



</body>
</html>